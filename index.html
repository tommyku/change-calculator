<html>
  <body>
    <script type='text/javascript'>
      class Coin {
      }

      class Penny extends Coin {
        static get VALUE() {
          return 0.01;
        }
      }

      class Nickel extends Coin {
        static get VALUE() {
          return 0.05;
        }
      }

      class Dime extends Coin {
        static get VALUE() {
          return 0.1;
        }
      }

      class Quarter extends Coin {
        static get VALUE() {
          return 0.25;
        }
      }

      class HalfDollar extends Coin {
        static get VALUE() {
          return 0.5;
        }
      }

      class Dollar extends Coin {
        static get VALUE() {
          return 1;
        }
      }

      class Pocket {
        constructor(coinPrototype) {
          this.coinType = coinPrototype
          this.count = 0;
        }

        add(count) {
          this.count += count;
        }

        take(count) {
          if (count > this.count) throw new Error('Not enough coins to take')
          this.count -= count;
        }

        getCoinType() {
          return this.coinType;
        }
      }

      class Wallet {
        constructor() {
          this.pockets = {};
          this.supportedCoinTypes = [Penny, Nickel, Dime, Quarter, HalfDollar, Dollar];
          this.supportedCoinTypes.forEach((coinType) => {
            this.pockets[coinType.name] = new Pocket(coinType);
          });
        }

        amount() {
          return Object.values(this.pockets).reduce((sum, pocket)=> {
            return sum + pocket.count * pocket.getCoinType().VALUE
          }, 0);
        }

        add(coinType, count) {
          this.pockets[coinType.name].add(count);
        }

        take(coinType, count) {
          this.pockets[coinType.name].take(count);
        }

        sortedCoinTypes(option = { ascending: true }) {
          return this.supportedCoinTypes.sort((coinTypeA, coinTypeB) => {
            return (coinTypeA.VALUE - coinTypeB.VALUE) * option.ascending ? -1 : 1;
          });
        }

        minCoin(result, amount) {
          let tmpAmount = amount;

          if (this.amount() < amount) {
            throw new Error('Not enough moeny');
          } else {
            const coinsTypes = this.sortedCoinTypes({ ascending: false });
            coinsTypes.forEach((coinType) => {
              const coinCount = this.pockets[coinType.name].count;
              const coinAmount = coinCount * coinType.VALUE;
              if (coinAmount <= tmpAmount) {
                tmpAmount -= coinAmount;
                result[coinType.name] = coinCount;
              } else {
                const maxTaken = parseInt(tmpAmount / coinType.VALUE, 10);
                tmpAmount -= coinType.VALUE * maxTaken;
                result[coinType.name] = maxTaken;
              }
              tmpAmount = tmpAmount.toFixed(2);

              if (tmpAmount === 0) return result;
            });
          }

          if (tmpAmount != 0) throw new Error('No such combination');

          return result;
        }

        maxCoin(result, amount) {
          // TODO: fix the case for maxCoin = true, try 1.05 with 5p, 1n and 2d
          return result;
        }

        payment(amount, option = { maxCoin: false }) {
          const result = {};
          this.supportedCoinTypes.forEach((coinType) => result[coinType.name] = 0);

          return option.maxCoin ? this.maxCoin(result, amount) : this.minCoin(result, amount);
        }
      }
      const wallet = new Wallet();
      wallet.add(Quarter, 2);
      wallet.add(Penny, 7);
      console.log(wallet.payment(0.57)); // base case

      const unluckyWallet = new Wallet();
      unluckyWallet.add(Penny, 5);
      unluckyWallet.add(Nickel, 1);
      unluckyWallet.add(Dollar, 2);
      // console.log(unluckyWallet.payment(0.11)); // no such combination
      // console.log(unluckyWallet.payment(1.05, { maxCoin: true })); // shuold be 1d, 5p
      // console.log(unluckyWallet.payment(1.04, { maxCoin: true })); // shuold be 1d, 4p
      console.log(unluckyWallet.payment(1.04, { maxCoin: false })); // works
    </script>
  </body>
</html>
